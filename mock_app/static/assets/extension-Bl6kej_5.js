import{c as g,a as f,j as e,r as d,C as b,b as y,S as j,R as v,D as N,W as m,d as w,e as C}from"./index-BqtRnf5D.js";const k=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],S=g("save",k);const L=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],M=g("send",L),u=f(t=>({logs:[],config:{provider:"local",url:"http://localhost:11434/v1",apiKey:"",model:"llama3",temperature:.7,prompt:"You are an expert trade surveillance analyst. Analyze the FDC3 logs for compliance issues."},addLog:s=>{const a={...s,id:Math.random().toString(36).substring(7),timestamp:Date.now()};t(r=>{const n=[a,...r.logs];return typeof chrome<"u"&&chrome.storage&&chrome.storage.local.set({chat_history:n}),{logs:n}})},clearLogs:()=>{t({logs:[]}),typeof chrome<"u"&&chrome.storage&&chrome.storage.local.remove("chat_history")},updateConfig:s=>{t(a=>{const r={...a.config,...s};return typeof chrome<"u"&&chrome.storage&&chrome.storage.local.set({ai_config:r}),{config:r}})},loadConfig:async()=>{if(typeof chrome<"u"&&chrome.storage){const s=await chrome.storage.local.get(["ai_config"]);if(s.ai_config){const a=s.ai_config;t(r=>({config:{...r.config,...a}}))}}},loadHistory:async()=>{if(typeof chrome<"u"&&chrome.storage){const s=await chrome.storage.local.get(["chat_history"]);s.chat_history&&Array.isArray(s.chat_history)&&t({logs:s.chat_history})}}})),A=({data:t})=>{const[s,a]=d.useState(!1);return t?e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-gray-500 cursor-pointer hover:text-gray-300",onClick:()=>a(!s),children:[s?e.jsx(b,{size:10}):e.jsx(y,{size:10}),s?"Hide Details":"View Payload"]}),s&&e.jsx("pre",{className:"mt-1 p-2 bg-black/50 border border-gray-800 rounded text-[10px] text-gray-400 overflow-x-auto",children:JSON.stringify(t,null,2)})]}):null},E=({entry:t})=>{const s=t.origin==="SYSTEM",a=()=>{if(!t.data)return null;let r=t.data.id?.ticker||t.data.ticker;if(t.data.type==="fdc3.order"){const n=t.data.details?.side||t.data.side||"",i=t.data.status||"";return r=t.data.details?.product?.id?.ticker||t.data.instrument?.id?.ticker||r||"Order",e.jsxs("span",{children:[n," ",e.jsx("span",{className:"text-[#4ade80] font-bold",children:r})," ",e.jsxs("span",{className:"text-gray-500",children:["(",i,")"]})]})}return r?e.jsx("span",{className:"text-[#4ade80] font-bold",children:r}):e.jsx("span",{className:"text-gray-400 truncate",children:JSON.stringify(t.data).substring(0,50)})};return t.type==="query"?e.jsxs("div",{className:"p-2 border-l-4 border-purple-500 bg-purple-500/10 mb-1 text-xs",children:[e.jsx("strong",{className:"text-purple-400",children:"You:"}),e.jsx("div",{className:"mt-1 text-gray-200",children:t.data})]}):t.type==="analysis"?e.jsxs("div",{className:"p-2 border-l-4 border-sky-400 bg-sky-400/10 mb-1 text-xs",children:[e.jsx("strong",{className:"text-sky-400",children:"AI Analysis:"}),e.jsx("div",{className:"mt-1 text-gray-200 whitespace-pre-wrap",children:t.data})]}):e.jsxs("div",{className:"p-2 border-b border-[#30363d] text-xs hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold ${s?"bg-orange-900 text-orange-200":"bg-blue-900 text-blue-200"}`,children:t.origin||"LOG"}),e.jsx("span",{className:"text-gray-500 text-[9px]",children:new Date(t.timestamp).toLocaleTimeString()})]}),e.jsx("div",{className:"text-gray-300",children:a()}),t.data&&t.data.type&&e.jsx("div",{className:"text-[9px] text-gray-500 mt-0.5",children:t.data.type}),e.jsx(A,{data:t.data})]})},_=()=>{const t=u(s=>s.logs);return e.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar",children:[t.length===0&&e.jsx("div",{className:"p-4 text-center text-gray-600 text-xs italic",children:"No logs captured yet..."}),t.map(s=>e.jsx(E,{entry:s},s.id))]})},D=()=>{const[t,s]=d.useState(""),[a,r]=d.useState(!1),{addLog:n,config:i}=u(),x=()=>{if(!t.trim())return;n({type:"query",data:t}),r(!0);const l=t;s(""),typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendNativeMessage?chrome.storage.local.get(["chat_history"],c=>{const o=c.chat_history||[];chrome.runtime.sendNativeMessage("com.interop.ai.lab",{logs:o,config:{...i,prompt:`${i.prompt}

User Question: ${l}`}},h=>{if(r(!1),chrome.runtime.lastError){n({type:"analysis",data:`Error: ${chrome.runtime.lastError.message}`});return}h&&h.analysis?n({type:"analysis",data:h.analysis}):n({type:"analysis",data:`Error: ${h?.error||"Unknown error"}`})})}):setTimeout(()=>{r(!1),n({type:"analysis",data:`(MOCK) Analysis for: "${l}"

No FDC3 activity detected relevant to this query.`})},1e3)};return e.jsxs("div",{className:"h-full flex flex-col p-2",children:[e.jsx("div",{className:"flex-grow flex flex-col justify-end text-xs text-gray-500 mb-2",children:e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 p-2 rounded mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-300 font-semibold mb-1",children:[e.jsx(j,{size:12}),"AI Analyst Ready"]}),e.jsxs("div",{className:"text-[10px]",children:["Model: ",e.jsx("span",{className:"text-white",children:i.model})," (",i.provider,")"]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-grow bg-[#0d1117] border border-[#30363d] rounded px-2 py-1.5 text-xs text-white focus:border-blue-500 focus:outline-none",placeholder:"Ask about your logs...",value:t,onChange:l=>s(l.target.value),onKeyDown:l=>l.key==="Enter"&&x(),disabled:a}),e.jsx("button",{className:`bg-blue-600 hover:bg-blue-500 text-white rounded px-3 py-1 flex items-center justify-center transition-colors ${a?"opacity-50 cursor-not-allowed":""}`,onClick:x,disabled:a,children:e.jsx(M,{size:14})})]})]})},I=()=>{const{config:t,updateConfig:s}=u(),[a,r]=d.useState(t),[n,i]=d.useState(!1);d.useEffect(()=>{r(t)},[t]);const x=()=>{s(a)},l=(o,h)=>{r(p=>({...p,[o]:h}))},c=()=>{i(!0),setTimeout(()=>i(!1),1e3)};return e.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar p-3 text-xs text-gray-300 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Provider"}),e.jsxs("select",{className:"w-full bg-[#0d1117] border border-[#30363d] rounded px-2 py-1",value:a.provider,onChange:o=>l("provider",o.target.value),children:[e.jsx("option",{value:"local",children:"Local (Ollama)"}),e.jsx("option",{value:"openai",children:"OpenAI"}),e.jsx("option",{value:"gemini",children:"Google Gemini"}),e.jsx("option",{value:"openrouter",children:"OpenRouter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Base URL"}),e.jsx("input",{type:"text",className:"w-full bg-[#0d1117] border border-[#30363d] rounded px-2 py-1",value:a.url,onChange:o=>l("url",o.target.value)})]}),a.provider!=="local"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"API Key"}),e.jsx("input",{type:"password",className:"w-full bg-[#0d1117] border border-[#30363d] rounded px-2 py-1",value:a.apiKey,onChange:o=>l("apiKey",o.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Model"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-grow bg-[#0d1117] border border-[#30363d] rounded px-2 py-1",value:a.model,onChange:o=>l("model",o.target.value)}),e.jsx("button",{className:"bg-[#21262d] border border-[#30363d] hover:bg-[#30363d] text-white rounded px-2",title:"List Models",children:e.jsx(v,{size:12})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-500 mb-1",children:["Temperature: ",a.temperature]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",className:"w-full",value:a.temperature,onChange:o=>l("temperature",parseFloat(o.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"System Prompt"}),e.jsx("textarea",{rows:3,className:"w-full bg-[#0d1117] border border-[#30363d] rounded px-2 py-1",value:a.prompt,onChange:o=>l("prompt",o.target.value)})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsxs("button",{className:"flex-1 bg-[#238636] hover:bg-[#2ea043] text-white py-1.5 rounded flex items-center justify-center gap-2 font-semibold",onClick:x,children:[e.jsx(S,{size:12})," Save"]}),e.jsx("button",{className:"flex-1 bg-[#21262d] border border-[#30363d] hover:bg-[#30363d] text-white py-1.5 rounded",onClick:c,children:n?"Testing...":"Test Connection"})]})]})},R=()=>{const{loadHistory:t,loadConfig:s,addLog:a}=u(),[r,n]=d.useState([{i:"logs",x:0,y:0,w:12,h:10},{i:"chat",x:0,y:10,w:12,h:4}]),[i,x]=d.useState(!1);d.useEffect(()=>{t(),s();const c=o=>{o&&o.source==="INTEROP_SNIFFER"&&a({type:"log",origin:"FDC3",data:o.payload?.data||o.payload})};return typeof chrome<"u"&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener(c),()=>{typeof chrome<"u"&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.removeListener(c)}},[]);const l=c=>{n(c)};return e.jsxs("div",{className:"app-container h-screen bg-[#0d1117] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"header px-3 py-2 bg-[#161b22] border-b border-[#30363d] flex justify-between items-center shrink-0",children:[e.jsx("span",{className:"font-bold text-sm text-white",children:"INTEROP LAB v2.0"}),e.jsx("button",{className:`p-1 rounded text-gray-400 hover:text-white ${i?"text-blue-400":""}`,onClick:()=>x(!i),children:"⚙️"})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsxs(N,{layout:r,onLayoutChange:l,children:[e.jsx("div",{children:e.jsx(m,{title:"FDC3 Log Feed",className:"h-full",children:e.jsx(_,{})})},"logs"),e.jsx("div",{children:e.jsx(m,{title:"AI Analyst",className:"h-full",children:e.jsx(D,{})})},"chat")]})}),i&&e.jsxs("div",{className:"absolute inset-0 bg-[#0d1117]/95 z-50 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b border-[#30363d] pb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Settings"}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsx(I,{})]})]})};w.createRoot(document.getElementById("root")).render(e.jsx(C.StrictMode,{children:e.jsx(R,{})}));
